<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- Pasamos production_data desde el reporte raíz hacia la plantilla final -->
  <template id="custom_producttemplatelabel_dymo" inherit_id="product.report_producttemplatelabel_dymo">
    <xpath expr="//t[@t-call='product.report_productlabel_dymo']" position="before">
      <t t-set="production_data" t-value="production_data"/>
    </xpath>
  </template>

  <!-- Plantilla final de la etiqueta visual -->
  <template id="custom_label_dymo_extension" inherit_id="product.report_simple_label_dymo">
    <xpath expr="//div[@class='o_label_full']" position="replace">
      <div class="o_label_full" style="width:76mm; height:36mm; padding:2mm; font-size:8.5px; font-family:Arial; display:flex; flex-direction:row; justify-content:space-between; align-items:flex-start; gap:2mm; page-break-after:always;">

        <!-- Columna izquierda: íconos -->
        <div style="display:flex; flex-direction:column; gap:2mm; width:14mm;">
          <img src="https://raw.githubusercontent.com/AdminDeglia/odoo_product_dimensions_with_product_label/ef2acd906621a4561225df0dd1d235682ca15023/Symbol_Resin_Code_4.svg" style="width:12mm; height:auto;" alt="Resin Code"/>
          <img src="https://github.com/AdminDeglia/odoo_product_dimensions_with_product_label/blob/17.0/images.jpg?raw=true" style="width:12mm; height:auto;" alt="Durabilidad"/>
          <img src="https://github.com/AdminDeglia/odoo_product_dimensions_with_product_label/blob/17.0/icone-de-recyclage-et-de-durabilite-noir.png?raw=true" style="width:12mm; height:auto;" alt="Reciclaje"/>
        </div>

        <!-- Centro: datos del producto -->
        <div style="flex:1; padding-left:5mm;">
          <!-- DEPURACIÓN -->
          <div style="color:red; font-size:10px;">[DEBUG]</div>
          <div>ID: <t t-esc="product.id if product else 'NO PRODUCT'"/></div>
          <div>Nombre: <t t-esc="product.display_name if product else 'VACIO'"/></div>
          <div>Barcode: <t t-esc="barcode if barcode else 'NO BARCODE'"/></div>
          <div>ProdData Lote: <t t-esc="production_data.get(product.id) if production_data else 'NO DATA'"/></div>

          <!-- Datos reales -->
          <div><strong><t t-esc="product.display_name"/></strong></div>
          <div>Lote: <t t-esc="production_data.get(product.id) if production_data else '-'"/></div>
          <div>Dim: <t t-esc="product.product_length"/>×<t t-esc="product.product_width"/>×<t t-esc="product.product_height"/></div>
          <div>Vol: <t t-esc="product.volume"/></div>
        </div>

        <!-- Derecha: código de barras y logo -->
        <div style="display:flex; flex-direction:column; align-items:flex-end; gap:2mm; width:15mm;">
          <t t-if="barcode">
            <div t-out="barcode" t-options="{'widget': 'barcode', 'quiet': 0, 'symbology': 'auto', 'img_style': 'width:15mm;height:10mm'}"></div>
          </t>
          <img src="https://github.com/AdminDeglia/odoo_product_dimensions_with_product_label/blob/17.0/Logo_valenciana.png?raw=true" style="width:10mm; height:10mm;" alt="Logo Valenciana"/>
        </div>

      </div>
    </xpath>
  </template>

</odoo>

